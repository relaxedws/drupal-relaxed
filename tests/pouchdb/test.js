var docs = [
  {"_id":"1111b3b1-6d76-4813-9e12-18d4e91e1111","@type":"entity_test","_rev":"1-a2a2bb67431dd59bf85bdd6d6ff81111","id":[{"value":"1"}],"uuid":[{"value":"1111b3b1-6d76-4813-9e12-18d4e91e1111"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 1"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"1"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":1,"ids":["1112bb67431dd59bf85bdd6d6ff81111"]}},
  {"_id":"2222b3b1-6d76-4813-9e12-18d4e91e2222","@type":"entity_test","_rev":"2-a2a2bb67431dd59bf85bdd6d6ff82222","id":[{"value":"2"}],"uuid":[{"value":"2222b3b1-6d76-4813-9e12-18d4e91e2222"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 2"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"2"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":2,"ids":["222a41544020dcf1bdcfa664e3760926","2229807df77d61db1b9efd3742965730"]}},
  {"_id":"3333b3b1-6d76-4813-9e12-18d4e91e3333","@type":"entity_test","_rev":"3-a2a2bb67431dd59bf85bdd6d6ff83333","id":[{"value":"3"}],"uuid":[{"value":"3333b3b1-6d76-4813-9e12-18d4e91e3333"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 3"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"3"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":3,"ids":["3338b75ab1947368ab7c9a632c0ea02a","333a41544020dcf1bdcfa674e3760926"]}},
  {"_id":"4444b3b1-6d76-4813-9e12-18d4e91e4444","@type":"entity_test","_rev":"4-a2a2bb67431dd59bf85bdd6d6ff84444","id":[{"value":"4"}],"uuid":[{"value":"4444b3b1-6d76-4813-9e12-18d4e91e4444"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 4"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"4"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":4,"ids":["4442bb67431dd59bf85bdd6d6ff81111"]}},
  {"_id":"5555b3b1-6d76-4813-9e12-18d4e91e5555","@type":"entity_test","_rev":"5-a2a2bb67431dd59bf85bdd6d6ff85555","id":[{"value":"5"}],"uuid":[{"value":"5555b3b1-6d76-4813-9e12-18d4e91e5555"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 5"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"5"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":5,"ids":["555a41544020dcf1bdcfa664e3760926","5559807df77d61db1b9efd3742965730"]}},
  {"_id":"6666b3b1-6d76-4813-9e12-18d4e91e6666","@type":"entity_test","_rev":"6-a2a2bb67431dd59bf85bdd6d6ff86666","id":[{"value":"6"}],"uuid":[{"value":"6666b3b1-6d76-4813-9e12-18d4e91e6666"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 6"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"6"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":6,"ids":["6668b75ab1947368ab7c9a632c0ea02a","666a41544020dcf1bdcfa674e3760926"]}},
  {"_id":"7777b3b1-6d76-4813-9e12-18d4e91e7777","@type":"entity_test","_rev":"7-a2a2bb67431dd59bf85bdd6d6ff87777","id":[{"value":"7"}],"uuid":[{"value":"7777b3b1-6d76-4813-9e12-18d4e91e7777"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 7"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"7"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":7,"ids":["7772bb67431dd59bf85bdd6d6ff81111"]}},
  {"_id":"8888b3b1-6d76-4813-9e12-18d4e91e8888","@type":"entity_test","_rev":"8-a2a2bb67431dd59bf85bdd6d6ff88888","id":[{"value":"8"}],"uuid":[{"value":"8888b3b1-6d76-4813-9e12-18d4e91e8888"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 8"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"8"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":8,"ids":["888a41544020dcf1bdcfa664e3760926","8889807df77d61db1b9efd3742965730"]}},
  {"_id":"9999b3b1-6d76-4813-9e12-18d4e91e9999","@type":"entity_test","_rev":"9-a2a2bb67431dd59bf85bdd6d6ff89999","id":[{"value":"9"}],"uuid":[{"value":"9999b3b1-6d76-4813-9e12-18d4e91e9999"}],"langcode":[{"value":"en"}],"name":[{"value":"Entity name 9"}],"type":[{"value":"entity_test"}],"user_id":[{"target_id":"1"}],"revision_id":[{"value":"9"}],"field_test_text":[{"value":null,"format":null}],"workspace":[{"target_id":"default"}],"_revisions":{"start":9,"ids":["9998b75ab1947368ab7c9a632c0ea02a","999a41544020dcf1bdcfa674e3760926"]}},
];

// Enable debugging mode.
//PouchDB.debug.enable('*');
//PouchDB.debug.enable('pouchdb:api');
//PouchDB.debug.enable('pouchdb:http');

describe('Test replication', function () {

  it('Test basic push replication', function (done) {
    var db = new PouchDB('pouch_to_drupal');
    var remote = new PouchDB('http://admin:admin@drupal.loc/relaxed/default');
    db.bulkDocs({ docs: docs }, {}, function (err, results) {
      db.replicate.to(remote, function (err, result) {
        result.ok.should.equal(true);
        result.docs_written.should.equal(docs.length);
        db.info(function (err, info) {
          console.log(err);
          verifyInfo(info, {
            update_seq: 9,
            doc_count: 9
          });
          done();
        });
      });
    });
  });

  it('Test basic pull replication', function (done) {
    var db = new PouchDB('drupal_to_pouch');
    var remote = new PouchDB('http://admin:admin@drupal.loc/relaxed/default');
    //remote.bulkDocs({ docs: docs }, {}, function (err, results) {
      db.replicate.from(remote, {}, function (err, result) {
        result.ok.should.equal(true);
        result.docs_written.should.equal(9);
        db.info(function (err, info) {
          verifyInfo(info, {
            update_seq: 9,
            doc_count: 9
          });
          done();
        });
      });
    //});
  });
});

function verifyInfo(info, expected) {
  if (!testUtils.isCouchMaster()) {
    info.update_seq.should.equal(expected.update_seq, 'update_seq');
  }
  info.doc_count.should.equal(expected.doc_count, 'doc_count');
}
